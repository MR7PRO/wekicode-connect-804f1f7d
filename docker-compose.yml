version: '3.8'

services:
  wekicode:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        - VITE_SUPABASE_URL=${VITE_SUPABASE_URL}
        - VITE_SUPABASE_PUBLISHABLE_KEY=${VITE_SUPABASE_PUBLISHABLE_KEY}
        - VITE_SUPABASE_PROJECT_ID=${VITE_SUPABASE_PROJECT_ID}
    ports:
      - "80:80"
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:80/health"]
      interval: 30s
      timeout: 3s
      retries: 3
      start_period: 5s
    environment:
      - NODE_ENV=production
    labels:
      - "com.wekicode.description=wekicode Platform"
      - "com.wekicode.version=1.0.0"

# Usage:
# 1. Copy .env.example to .env and fill in your Supabase values
# 2. Run: docker-compose up -d
# 3. Access: http://localhost

# For production with HTTPS (using Traefik or nginx-proxy):
# Add these labels for automatic SSL:
#   - "traefik.enable=true"
#   - "traefik.http.routers.wekicode.rule=Host(`yourdomain.com`)"
#   - "traefik.http.routers.wekicode.entrypoints=websecure"
#   - "traefik.http.routers.wekicode.tls.certresolver=letsencrypt"
